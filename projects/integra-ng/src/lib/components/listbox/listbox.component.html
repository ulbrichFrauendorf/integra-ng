<div
  class="i-listbox-wrapper"
  [class.i-listbox--fluid]="fluid"
  [class.i-listbox--disabled]="disabled"
  [class.i-listbox--invalid]="showErrors"
  #dropdown
>
  <!-- Header -->
  <div class="i-listbox-header">
    <div class="i-listbox-header-content">
      <span class="i-listbox-title">{{ effectiveTitle }}</span>
      @if (actionIcon) {
      <i-button
        [text]="true"
        [size]="'small'"
        [severity]="'contrast'"
        [icon]="actionIcon"
        [disabled]="disabled"
        (clicked)="onActionClick($event)"
        [attr.title]="actionTooltip"
      ></i-button>
      }
    </div>

    <!-- Chips area for multiselect mode -->
    @if (multiple && hasValue()) {
    <i-chips
      class="i-listbox-chips"
      [chips]="getSelectedChipItems()"
      [removable]="!disabled"
      [disabled]="disabled"
      [collapseOnOverflow]="true"
      [overflowLabel]="getDisplayLabel()"
      (removeChip)="onChipRemove($event)"
    ></i-chips>
    }
  </div>

  <!-- Dropdown content -->
  <div class="i-listbox-dropdown">
    @if (filter) {
    <div class="i-listbox-filter">
      <i-input-text
        #searchInput
        [useFloatLabel]="false"
        placeholder="Search..."
        [ngModel]="filterValue()"
        (ngModelChange)="filterValue.set($event)"
        [fluid]="true"
        [icon]="'pi pi-search'"
      >
      </i-input-text>
    </div>
    }

    <div class="i-listbox-options">
      @for (option of filteredOptions(); track getOptionValue(option)) {
      <div
        class="i-listbox-option"
        [class.selected]="isOptionSelected(option)"
        (click)="toggleOption(option)"
      >
        <!-- Checkbox only in multiple mode -->
        @if (multiple) {
        <i-checkbox
          [checked]="isOptionSelected(option)"
          [readonly]="true"
          size="small"
          class="i-listbox-checkbox"
        ></i-checkbox>
        }

        <!-- Left icon -->
        @if (getOptionLeftIcon(option)) {
        <i
          [class]="getOptionLeftIcon(option)"
          class="i-listbox-option-icon i-listbox-option-icon--left"
        ></i>
        }

        <span class="i-listbox-option-label">
          {{ getOptionLabel(option) }}
        </span>

        <!-- Right icon -->
        @if (getOptionRightIcon(option)) {
        <i
          [class]="getOptionRightIcon(option)"
          class="i-listbox-option-icon i-listbox-option-icon--right"
        ></i>
        }
      </div>
      } @if (filteredOptions().length === 0) {
      <div class="i-listbox-no-options">No options found</div>
      }
    </div>
  </div>

  <!-- Error message -->
  @if (showErrors) {
  <div class="i-listbox-error">
    {{ getErrorMessage() }}
  </div>
  }
</div>
