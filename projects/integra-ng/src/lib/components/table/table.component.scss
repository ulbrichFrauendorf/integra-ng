@use "./table.component.theme.scss" as theme;
@use "../../themes/scrollbar-mixins.scss" as scrollbar;
@use "../../themes/variables" as vars;

@include theme.i-table-theme();

$table-transition: 0.15s ease;

.i-table-wrapper {
  position: relative;
  display: block;
  border-radius: vars.$componentBorderRadius;
  overflow: visible;

  &.i-table--small table {
    thead th {
      padding: 8px 12px;
      font-size: 13px;
    }

    tbody td {
      padding: 6px 12px;
      font-size: 1em;
    }

    .i-table-filter-row th {
      padding: 4px 12px;
    }
  }

  &.i-table--large table {
    thead th {
      padding: 16px 20px;
      font-size: 16px;
    }

    tbody td {
      padding: 16px 20px;
      font-size: 16px;
    }

    .i-table-filter-row th {
      padding: 12px 20px;
    }
  }

  &.i-table--scrollable table {
    table-layout: fixed;
  }

  &.i-table--loading {
    pointer-events: none;
    user-select: none;
  }

  .i-table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    gap: 16px;

    .i-table-header-start {
      flex: 0 1 auto;
      display: flex;
      align-items: center;
    }

    .i-table-header-end {
      flex: 0 1 auto;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: auto;

      .i-table-global-filter {
        width: 250px;
      }

      .i-table-download {
        flex-shrink: 0;
      }
    }
  }

  .i-table-loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;

    .i-table-loading-icon {
      font-size: 32px;
    }
  }

  .i-table-container {
    overflow-x: auto;
    @include scrollbar.dropdown-scrollbar();

    &--scrollable {
      overflow-y: auto;

      thead {
        position: sticky;
        top: 0;
        z-index: 2;
      }
    }
  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: auto;

    thead {
      tr th {
        position: relative;
        padding: 12px 16px;
        font-weight: 600;
        text-align: left;
        white-space: nowrap;
        user-select: none;

        .i-table-header-content {
          display: flex;
          align-items: center;
          gap: 8px;

          .i-table-header-text {
            flex: 1;
          }
        }

        .i-table-sort-icon {
          font-size: 1em;
          opacity: 0.6;
          transition: opacity $table-transition, color $table-transition;
        }

        &.i-table-sortable-column {
          transition: background-color $table-transition;

          .i-table-sort-icon {
            opacity: 0.4;
          }

          &:hover .i-table-sort-icon,
          &.i-table-sorted .i-table-sort-icon {
            opacity: 1;
          }
        }

        &:hover .i-table-column-resizer {
          opacity: 0.5;
        }
      }

      .i-table-filter-row th {
        padding: 8px 16px;

        .i-table-column-filter {
          width: 100%;
          padding: 6px 10px;
          font-size: 1em;
          border-radius: vars.$componentBorderRadius;
          transition: border-color $table-transition,
            box-shadow $table-transition;
        }
      }
    }

    tbody {
      display: table-row-group;

      tr {
        transition: background-color $table-transition;

        td {
          padding: 12px 16px;
          vertical-align: middle;
        }
      }

      .i-table-empty-row td {
        padding: 40px 16px;
        text-align: center;
      }

      .i-table-expanded-row td {
        padding: 0;

        .i-table-expanded-content {
          padding: 16px;
          margin: 8px 16px;
          border-radius: vars.$componentBorderRadius;

          pre {
            margin: 0;
            font-family: monospace;
            font-size: 1em;
            white-space: pre-wrap;
            word-wrap: break-word;
          }
        }
      }

      // Grouped data styles
      .i-table-group-header {
        td {
          padding: 12px 16px;
          font-weight: 600;
          cursor: pointer;
          user-select: none;
          transition: background-color $table-transition;

          &:hover {
            opacity: 0.8;
          }
        }

        .i-table-group-header-content {
          display: flex;
          align-items: center;
          gap: 8px;

          .i-table-group-toggle-icon {
            font-size: 0.9em;
            transition: transform $table-transition;
          }

          .i-table-group-label {
            flex: 1;
            font-size: 1.1em;
          }

          .i-table-group-count {
            opacity: 0.7;
            font-size: 0.9em;
            font-weight: 400;
          }
        }
      }

      .i-table-group-columns-header {
        th {
          font-size: 0.95em;
          font-weight: 600;
          padding: 10px 16px;
        }
      }

      .i-table-group-row {
        td {
          padding-left: 32px;

          &:first-child {
            padding-left: 16px;
          }
        }
      }
    }
  }

  .i-table-selection-header,
  .i-table-selection-cell,
  .i-table-expand-header,
  .i-table-expand-cell {
    width: 50px;
    text-align: center;
  }

  .i-table-actions-header,
  .i-table-actions-cell {
    width: auto;
    white-space: nowrap;

    .i-table-actions {
      display: flex;
      gap: 4px;
      justify-content: flex-end;
    }
  }

  .i-table-column-resizer {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 60%;
    cursor: col-resize;
    opacity: 0;
    transition: opacity $table-transition, background-color $table-transition;

    &:hover {
      opacity: 1;
    }
  }
}

@media (max-width: 768px) {
  .i-table-wrapper .i-table-header {
    padding: 8px 12px;
    flex-wrap: wrap;

    .i-table-header-start {
      flex: 1 1 100%;
      margin-bottom: 8px;
    }

    .i-table-header-end {
      flex: 1 1 100%;
      justify-content: flex-end;

      .i-table-global-filter {
        flex: 1;
        max-width: 250px;
      }
    }
  }
}
